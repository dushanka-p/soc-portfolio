# ðŸ›¡ï¸ Playbook: T1078.001 â€” Default Accounts (Guest Enabled)

**MITRE ATT&CK:** T1078.001 â€“ [Valid Accounts: Default Accounts](https://attack.mitre.org/techniques/T1078/001/)  
**Detection:** Microsoft Sentinel (or other SIEM) â€” Scheduled rule  
**Applies to:** Any Windows host where a built-in account (e.g., `guest`) is enabled and added to privileged groups

---

## ðŸš¨ When this triggers (what happened?)

* **Alert:** Detection of default/built-in account (e.g., `guest`) being enabled, added to privileged groups (e.g., Administrators, Remote Desktop Users), or used to enable RDP.
* **Detection:** Rule matches `net user` / `net1.exe` / `net localgroup` activity and/or Windows SecurityEvent (e.g., 4722 - user enabled, 4732 - group add).

---

## ðŸ•µï¸ What to check (triage steps)

1. **Confirm alert:**  
   Is this a legitimate admin action, maintenance, or scheduled task?
2. **Evidence:**  
   * Process telemetry for account enable/group add commands  
   * Security events:  
     - 4722 (account enabled),  
     - 4732 (added to group),  
     - 4720 (created)  
   * Registry keys:  
     - `fDenyTSConnections=0` (RDP enabled)  
   * Any unusual logins or outbound connections after?

---

## ðŸƒâ€â™‚ï¸ What to do (response steps)

1. **Disable the account:**  
   * `net user [account] /active:no`
2. **Remove from groups:**  
   * `net localgroup Administrators [account] /delete`
   * `net localgroup "Remote Desktop Users" [account] /delete`
3. **Revert RDP setting:**  
   * `Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server' -Name 'fDenyTSConnections' -Value 1`
4. **Restore system/snapshot if needed.**

---

## âœ… When is it closed?

* Account is disabled, removed from all privileged groups, RDP access locked down, and no suspicious activity found.
* Actions/evidence documented in the incident ticket.

---

## ðŸ“„ Detection Rule (KQL example)

```kql
DeviceProcessEvents
| where InitiatingProcessFileName has_any ("cmd.exe", "powershell.exe", "net.exe", "net1.exe")
| where ProcessCommandLine has_any ("net user", "net localgroup", "Administrators", "Remote Desktop Users")
| project TimeGenerated, DeviceName, InitiatingProcessAccountName, ProcessCommandLine
| union (
    SecurityEvent
    | where EventID == 4722 or EventID == 4732
    | project TimeGenerated, Computer, EventID, TargetUserName
)
````

---

**Manager summary:**
Default/built-in account enabled and added to privileged group. Host contained, account disabled and removed, RDP locked, no further activity observed.

---

> **Escalation Tip:**
> If seen in production and not expected, escalate and check for:
>
> * New logins using the affected account
> * Lateral movement or persistence
> * Other hosts with similar activity

---
